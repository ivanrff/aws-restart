# Creating an EC2 instance with Termination Protection
![](lab-scenario.jpeg)

This lab provides you with a basic overview of launching, resizing, managing, and monitoring an Amazon EC2 instance.

Amazon Elastic Compute Cloud (Amazon EC2) is a web service that provides resizable compute capacity in the cloud. It is designed to make web-scale cloud computing easier for developers.

Amazon EC2's simple web service interface allows you to obtain and configure capacity with minimal friction. It provides you with complete control of your computing resources and lets you run on Amazon's proven computing environment. Amazon EC2 reduces the time required to obtain and boot new server instances to minutes, allowing you to quickly scale capacity, both up and down, as your computing requirements change.

Amazon EC2 changes the economics of computing by allowing you to pay only for capacity that you actually use. Amazon EC2 provides developers the tools to build failure resilient applications and isolate themselves from common failure scenarios.

## Topics covered
By the end of this lab, you will be able to:

- Launch a web server with termination protection enabled
- Monitor Your EC2 instance
- Modify the security group that your web server is using to allow HTTP access
- Resize your Amazon EC2 instance to scale
- Test termination protection
- Terminate your EC2 instance

## Duration
This lab takes approximately 45 minutes to complete.

# Task 1: Launching your EC2 instance

- Instance Name: `Web Server`
- AMI: `Amazon Linux 2023`
- Instance Type: `t3.micro`
- Key Pair (login): `Proceed without a key pair (not recommended)`
    * key pairs are used to access the instance remotely, through `SSH` for Linux and `RDP` for Windows.
    * the public key is stored in the EC2 instance.
    * the private key is downloaded (`.pem` or `.ppk`)
- VPC: `Lab VPC`
- Security Group: 
    - Name: `Web Server security group`
    - Description: `Security group for my web server`
    - Inbound Rules: Remove `SSH`, add `HTTP/Ipv4 Anywhere`
- Storage: `8 GiB`
- Termination protection: `Enable`
- User data:
```
#!/bin/bash
yum -y install httpd
systemctl enable httpd
systemctl start httpd
echo '<html><h1>Hello From Your Web Server!</h1></html>' > /var/www/html/index.html
```
- `#!/bin/bash`: every initialization script must have this as its first line, so the system interprets the code as a bash script.
- `yum -y install httpd`: `yum` is the package installer. This installs **Apache** (called `httpd` on Linux). `-y` sends Yes to all script questions, so it doesn't get stuck.
- `systemctl enable httpd`: makes Apache start automatically everytime the instance is rebooted.
- `systemctl start httpd`: turns the server on imediatelly.
- `echo '<html>...</html>' > /var/www/html/index.html` creates a simple web page through the index.html file, which is placed in the standard Apache folder.

# Task 2: Monitoring

If you are unable to reach your instance via SSH or RDP, you can capture a screenshot of your instance and view it as an image. This provides visibility as to the status of the instance, and allows for quicker troubleshooting.

Actions > Monitor and troubleshoot > Get Instance Screenshot

# Task 3: Update Your Security Group and Access the Web Server

- The security group should allow for HTTP access from Anywhere-IPv4
- Check if the connection is working by accessing the instance's public IP.

# Task 4: Resize Your Instance: Instance Type and EBS Volume

- Stop the instance;
- Change instance type to `t3.small`;
- Change EBS volume from `8` to `10 GiB`;
- Start instance again;

# Task 5: Test Termination Protection

- Terminate (delete) instance
    - You will receive an error.
- Disable Termination Protection
- Terminate instance.

# Not included in the lab: Enabling HTTPS connections

Apache allows for HTTPS, but it needs an extra module (`mod_ssl`).
You also need an SSL certificate, or else any browser connection will show the "Your connection isn't safe" page.
You can install both in the instance but that isn't how it's usually done.

The standard is:
- Add an Application Load Balancer before the instance.
- Install the SSL certificate in the ELB.
- The Load Balancer will then receive traffic `HTTPS` through `443` and send it to your instance with `HTTP` through `80`.
- In the EC2 Instance Security Group, you add the inbound rule:
    - `HTTP` (`80`), Source: ELB Security Group ID (ex: `sg-123456`).

- You don't need to worry about Outbound Rules if you did not delete the standard `0.0.0.0/0` rule.

This practice takes the processing load of encryption from your instance, so it can focus on processing the relevant data.